<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DepositSafe | Dashboard</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="page">
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <h1 class="logo">DepositSafe</h1>
        <p class="logo-subtitle">Secure Escrow Platform</p>
      </div>
      
      <div class="sidebar-menu">
        <a href="dashboard.html" class="menu-item active" data-page="dashboard">
          <span class="menu-icon">ğŸ“Š</span>
          <span>Dashboard</span>
        </a>
        <a href="history.html" class="menu-item" data-page="history">
          <span class="menu-icon">ğŸ“œ</span>
          <span>History</span>
        </a>
        <a href="settings.html" class="menu-item" data-page="settings">
          <span class="menu-icon">âš™ï¸</span>
          <span>Settings</span>
        </a>
        <a href="buy-xlusd.html" class="menu-item" data-page="buy">
          <span class="menu-icon">ğŸ’°</span>
          <span>Buy XLUSD</span>
        </a>
        <a href="withdraw.html" class="menu-item" data-page="withdraw">
          <span class="menu-icon">ğŸ’¸</span>
          <span>Withdraw</span>
        </a>
        <a href="profile.html" class="menu-item" data-page="profile">
          <span class="menu-icon">ğŸ‘¤</span>
          <span>Profile</span>
        </a>
      </div>

      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar">
            <span id="userInitial">U</span>
          </div>
          <div class="user-details">
            <div class="user-name" id="sidebarUser">Loading...</div>
            <div class="user-email" id="sidebarEmail">...</div>
          </div>
        </div>
        <a href="index.html" class="menu-item logout">
          <span class="menu-icon">ğŸšª</span>
          <span>Log out</span>
        </a>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
      <div class="topbar">
        <div>
          <h2>Dashboard Overview</h2>
          <p class="muted">Welcome back, <span id="who"></span></p>
        </div>
        <div class="topbar-actions">
          <div class="balance-display">
            <span class="balance-label">XLUSD Balance:</span>
            <span class="balance-value" id="xlusdBalance">Loading...</span>
          </div>
          <button id="btnBuyXLUSD" class="btn-buy">ğŸ’³ Buy XLUSD</button>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">ğŸ“¦</div>
          <div class="stat-content">
            <div class="stat-label">Total Escrows</div>
            <div class="stat-value" id="totalEscrows">0</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">ğŸ’µ</div>
          <div class="stat-content">
            <div class="stat-label">Total Value</div>
            <div class="stat-value" id="totalValue">0 XRP</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">ğŸ’°</div>
          <div class="stat-content">
            <div class="stat-label">XRP Wallet Balance</div>
            <div class="stat-value" id="xrpWalletBalance">-</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">âœ…</div>
          <div class="stat-content">
            <div class="stat-label">Completed</div>
            <div class="stat-value" id="completedCount">0</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">â³</div>
          <div class="stat-content">
            <div class="stat-label">Pending</div>
            <div class="stat-value" id="pendingCount">0</div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="activity-card">
        <div class="card-header">
          <h3>Recent Activity</h3>
          <a href="history.html" class="view-all">View All â†’</a>
        </div>
        <div class="activity-list" id="recentActivity">
          <div class="activity-empty">No recent activity</div>
        </div>
      </div>

      <!-- Quality Assurance Escrow Card -->
      <div class="card" style="grid-column: 1 / -1; margin-bottom: 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
        <h3 style="color: white; margin-bottom: 8px;">âœ… Quality Assurance Escrow</h3>
        <p style="color: rgba(255,255,255,0.9); margin-bottom: 20px; font-size: 14px;">
          Client locks payment with quality requirements â†’ Service provider delivers â†’ Client validates checklist â†’ Service provider claims payment (before deadline) OR client refunds (after deadline).
        </p>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 24px;">
          <!-- Client Side: Create QA Escrow -->
          <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px;">
            <h4 style="color: white; margin: 0 0 16px; font-size: 16px;">ğŸ‘¤ As Client (Create Escrow)</h4>
            
            <label style="color: rgba(255,255,255,0.9);">Service Provider XRPL Address</label>
            <input id="qa_provider" placeholder="r..." style="margin-bottom: 12px;" autocomplete="off" />
            
            <label style="color: rgba(255,255,255,0.9);">Payment Amount (XRP)</label>
            <input id="qa_amount" type="number" step="0.000001" min="0.000001" placeholder="100.0" style="margin-bottom: 12px;" autocomplete="off" />
            
            <label style="color: rgba(255,255,255,0.9);">Deadline (refund available after)</label>
            <input id="qa_deadline" type="datetime-local" style="margin-bottom: 16px;" />
            
            <label style="color: rgba(255,255,255,0.9); margin-bottom: 8px; display: block;">Quality Requirements Checklist (Optional):</label>
            <p style="font-size: 11px; color: rgba(255,255,255,0.7); margin-bottom: 8px;">
              ğŸ’¡ Leave empty if you don't need requirements. Service provider can claim payment anytime before deadline.
            </p>
            <div id="qa_checklist" style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; margin-bottom: 12px; min-height: 60px;">
              <p style="font-size: 11px; color: rgba(255,255,255,0.6); font-style: italic; margin: 0;">
                No requirements added. Click "Add Requirement" to add quality checks.
              </p>
            </div>
            <button type="button" id="btnAddRequirement" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; font-size: 12px; cursor: pointer; margin-bottom: 12px;">
              â• Add Requirement (Optional)
            </button>
            
            <button id="btnQACreate" style="width: 100%; background: white; color: #10b981; font-weight: 700;">ğŸ”’ Lock Payment</button>
            
            <div class="result" id="resQACreate" style="margin-top: 12px; background: rgba(255,255,255,0.2); color: white;"></div>
            
            <div id="qa_approvalSection" style="margin-top: 12px; padding: 12px; background: rgba(255,255,255,0.15); border-radius: 8px; display: none;">
              <label style="color: rgba(255,255,255,0.9); font-size: 13px; display: block; margin-bottom: 8px;">âœ… Approval Key (Preimage):</label>
              <input id="qa_preimage" placeholder="Will show after creation" readonly style="font-family: monospace; font-size: 11px; background: rgba(0,0,0,0.2); color: white; width: 100%; padding: 8px; border: none; border-radius: 4px; margin-bottom: 8px;" />
              <p style="font-size: 11px; color: rgba(255,255,255,0.8); margin: 0;">
                ğŸ’¡ Share this approval key with service provider ONLY after all requirements are met.
              </p>
            </div>
          </div>
          
          <!-- Client Side: View AI Verification Status -->
          <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px;">
            <h4 style="color: white; margin: 0 0 16px; font-size: 16px;">ğŸ¤– AI Verification Status</h4>
            
            <label style="color: rgba(255,255,255,0.9);">Escrow Owner (Your address)</label>
            <input id="qa_approve_owner" placeholder="r..." style="margin-bottom: 12px;" autocomplete="off" />
            
            <label style="color: rgba(255,255,255,0.9);">Escrow Sequence</label>
            <input id="qa_approve_seq" type="number" placeholder="123" min="1" style="margin-bottom: 12px;" autocomplete="off" />
            
            <label style="color: rgba(255,255,255,0.9); margin-bottom: 8px; display: block;">AI Verification Results:</label>
            <div id="qa_verify_checklist" style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; margin-bottom: 12px; min-height: 80px;">
              <p style="font-size: 12px; color: rgba(255,255,255,0.7); margin: 0; font-style: italic;">
                Enter escrow sequence to view AI verification status...
              </p>
            </div>
            
            <button id="btnQALoadRequirements" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; font-size: 12px; cursor: pointer; margin-bottom: 12px;">
              ğŸ” View AI Verification Status
            </button>
            
            <button id="btnQATriggerAI" style="width: 100%; background: #3b82f6; color: white; font-weight: 700; margin-bottom: 12px;">
              ğŸ¤– Re-run AI Verification
            </button>
            
            <button id="btnQARefund" style="width: 100%; background: #ef4444; color: white; font-weight: 700;">
              âŒ Refund (After Deadline)
            </button>
            
            <div class="result" id="resQAApprove" style="margin-top: 12px; background: rgba(255,255,255,0.2); color: white;"></div>
          </div>

          <!-- Service Provider Side: Claim Payment -->
          <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px;">
            <h4 style="color: white; margin: 0 0 16px; font-size: 16px;">ğŸ’° As Service Provider (Claim Payment)</h4>
            
            <label style="color: rgba(255,255,255,0.9);">Escrow Owner (Client address)</label>
            <input id="qa_claim_owner" placeholder="r..." style="margin-bottom: 12px;" autocomplete="off" />
            
            <label style="color: rgba(255,255,255,0.9);">Escrow Sequence</label>
            <input id="qa_claim_seq" type="number" placeholder="123" min="1" style="margin-bottom: 16px;" autocomplete="off" />
            
            <button id="btnQAClaim" style="width: 100%; background: #3b82f6; color: white; font-weight: 700;">
              ğŸ’° Claim Payment
            </button>
            
            <p style="font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 12px; margin-bottom: 0;">
              âš ï¸ If escrow has requirements, you can only claim after client verifies them all. You can only claim BEFORE the deadline passes. After deadline, the client can refund.
            </p>
            
            <div class="result" id="resQAClaim" style="margin-top: 12px; background: rgba(255,255,255,0.2); color: white;"></div>
          </div>
        </div>
      </div>

    <script src="dashboard.js"></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DepositSafe | Dashboard</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="page">
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <h1 class="logo">DepositSafe</h1>
        <p class="logo-subtitle">Secure Escrow Platform</p>
      </div>
      
      <div class="sidebar-menu">
        <a href="dashboard.html" class="menu-item active" data-page="dashboard">
          <span class="menu-icon">üìä</span>
          <span>Dashboard</span>
        </a>
        <a href="history.html" class="menu-item" data-page="history">
          <span class="menu-icon">üìú</span>
          <span>History</span>
        </a>
        <a href="settings.html" class="menu-item" data-page="settings">
          <span class="menu-icon">‚öôÔ∏è</span>
          <span>Settings</span>
        </a>
        <a href="buy-xlusd.html" class="menu-item" data-page="buy">
          <span class="menu-icon">üí∞</span>
          <span>Buy XLUSD</span>
        </a>
        <a href="withdraw.html" class="menu-item" data-page="withdraw">
          <span class="menu-icon">üí∏</span>
          <span>Withdraw</span>
        </a>
        <a href="profile.html" class="menu-item" data-page="profile">
          <span class="menu-icon">üë§</span>
          <span>Profile</span>
        </a>
      </div>

      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar">
            <span id="userInitial">U</span>
          </div>
          <div class="user-details">
            <div class="user-name" id="sidebarUser">Loading...</div>
            <div class="user-email" id="sidebarEmail">...</div>
          </div>
        </div>
        <a href="index.html" class="menu-item logout">
          <span class="menu-icon">üö™</span>
          <span>Log out</span>
        </a>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
      <div class="topbar">
        <div>
          <h2>Dashboard Overview</h2>
          <p class="muted">Welcome back, <span id="who"></span></p>
        </div>
        <div class="topbar-actions">
          <div class="balance-display">
            <span class="balance-label">XLUSD Balance:</span>
            <span class="balance-value" id="xlusdBalance">Loading...</span>
          </div>
          <button id="btnBuyXLUSD" class="btn-buy">üí≥ Buy XLUSD</button>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üì¶</div>
          <div class="stat-content">
            <div class="stat-label">Total Escrows</div>
            <div class="stat-value" id="totalEscrows">0</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">üíµ</div>
          <div class="stat-content">
            <div class="stat-label">Total Value</div>
            <div class="stat-value" id="totalValue">0 XRP</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">‚úÖ</div>
          <div class="stat-content">
            <div class="stat-label">Completed</div>
            <div class="stat-value" id="completedCount">0</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">‚è≥</div>
          <div class="stat-content">
            <div class="stat-label">Pending</div>
            <div class="stat-value" id="pendingCount">0</div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="activity-card">
        <div class="card-header">
          <h3>Recent Activity</h3>
          <a href="history.html" class="view-all">View All ‚Üí</a>
        </div>
        <div class="activity-list" id="recentActivity">
          <div class="activity-empty">No recent activity</div>
        </div>
      </div>

      <!-- Freelancer Payment Workflow Card -->
      <div class="card" style="grid-column: 1 / -1; margin-bottom: 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <h3 style="color: white; margin-bottom: 8px;">üíº Freelancer Payment Workflow</h3>
        <p style="color: rgba(255,255,255,0.9); margin-bottom: 20px; font-size: 14px;">
          Client locks payment ‚Üí Freelancer delivers ‚Üí Client releases when satisfied, OR auto-refund after deadline.
        </p>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
          <!-- Client Side -->
          <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px;">
            <h4 style="color: white; margin: 0 0 16px; font-size: 16px;">üë§ As Client (Lock Payment)</h4>
            
            <label style="color: rgba(255,255,255,0.9);">Freelancer XRPL Address</label>
            <input id="f_freelancer" placeholder="r..." style="margin-bottom: 12px;" autocomplete="off" />
            
            <label style="color: rgba(255,255,255,0.9);">Payment Amount (XRP)</label>
            <input id="f_amount" type="number" step="0.000001" min="0.000001" placeholder="100.0" style="margin-bottom: 12px;" autocomplete="off" />
            
            <label style="color: rgba(255,255,255,0.9);">Deadline (when auto-refund becomes available)</label>
            <input id="f_deadline" type="datetime-local" style="margin-bottom: 16px;" />
            
            <button id="btnFreelancerCreate" style="width: 100%; background: white; color: #667eea; font-weight: 700;">üîí Lock Payment</button>
            
            <div class="result" id="resFreelancerCreate" style="margin-top: 12px; background: rgba(255,255,255,0.2); color: white;"></div>
          </div>
          
          <!-- Release/Refund Side -->
          <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px;">
            <h4 style="color: white; margin: 0 0 16px; font-size: 16px;">‚úÖ Release Payment / Refund</h4>
            
            <label style="color: rgba(255,255,255,0.9);">Escrow Owner (Client address)</label>
            <input id="f_release_owner" placeholder="r..." style="margin-bottom: 12px;" autocomplete="off" />
            
            <label style="color: rgba(255,255,255,0.9);">Escrow Sequence</label>
            <input id="f_release_seq" type="number" placeholder="123" min="1" style="margin-bottom: 12px;" autocomplete="off" />
            
            <div style="display: flex; gap: 8px;">
              <button id="btnFreelancerRelease" style="flex: 1; background: #10b981; color: white; font-weight: 700;">
                üí∞ Release (Share Preimage)
              </button>
              <button id="btnFreelancerRefund" style="flex: 1; background: #ef4444; color: white; font-weight: 700;">
                ‚ùå Refund After Deadline
              </button>
            </div>
            
            <div id="f_preimageSection" style="margin-top: 12px; padding: 12px; background: rgba(255,255,255,0.15); border-radius: 8px; display: none;">
              <label style="color: rgba(255,255,255,0.9); font-size: 13px;">Preimage to Share with Freelancer:</label>
              <input id="f_preimage" placeholder="Will show after creation" readonly style="font-family: monospace; font-size: 11px; background: rgba(0,0,0,0.2); color: white; margin-top: 4px;" />
              <button type="button" id="btnCopyPreimage" style="margin-top: 8px; padding: 6px 12px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; font-size: 12px; cursor: pointer;">üìã Copy Preimage</button>
            </div>
            
            <div class="result" id="resFreelancerRelease" style="margin-top: 12px; background: rgba(255,255,255,0.2); color: white;"></div>
          </div>
        </div>
      </div>

      <div class="grid">
      <!-- Make Deposit -->
      <div class="card">
        <h3>Flow A ‚Äî Make Deposit (EscrowCreate)</h3>
        <p class="muted">Payer locks XRP into escrow for a payee. Supports conditional releases for hotel bookings, tour reservations, etc.</p>

        <label>Payee XRPL Address <span style="color: #718096; font-weight: 400;">(who will receive the funds)</span></label>
        <input id="a_payee" placeholder="r..." autocomplete="off" />

        <label>Amount (XRP) <span style="color: #718096; font-weight: 400;">(minimum: 0.000001 XRP)</span></label>
        <input id="a_amount" type="number" step="0.000001" min="0.000001" placeholder="10.0" autocomplete="off" />

        <label>Release Time (FinishAfter) <span style="color: #718096; font-weight: 400;">(when payee can claim funds, or fallback for conditional escrow)</span></label>
        <input id="a_finish" type="datetime-local" />

        <label>Cancel Time (CancelAfter) <span style="color: #718096; font-weight: 400;">(optional - when payer can refund)</span></label>
        <input id="a_cancel" type="datetime-local" />

        <div style="margin: 16px 0; padding: 12px; background: #f0f4ff; border-radius: 8px; border: 1px solid rgba(102, 126, 234, 0.2);">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 0;">
            <input type="checkbox" id="a_useCondition" style="width: 18px; height: 18px; margin: 0; cursor: pointer;" />
            <span style="font-weight: 600; color: #667eea;">Enable Conditional Escrow</span>
          </label>
          <p style="margin: 8px 0 0 26px; font-size: 12px; color: #718096;">Use for hotel bookings, tour reservations, etc. Funds require cryptographic proof to release.</p>
        </div>

        <div id="a_conditionalSection" style="display: none; margin-top: 16px; padding: 16px; background: #fff8e1; border-radius: 8px; border: 1px solid rgba(251, 191, 36, 0.3);">
          <label>Condition (hex) <span style="color: #718096; font-weight: 400;">(cryptographic condition)</span></label>
          <div style="display: flex; gap: 8px;">
            <input id="a_condition" placeholder="Auto-generated or paste condition" style="flex: 1;" autocomplete="off" />
            <button type="button" id="btnGenerateCondition" style="padding: 12px 16px; white-space: nowrap; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">Generate</button>
          </div>
          <div id="a_conditionPair" style="margin-top: 12px; padding: 12px; background: #fff; border-radius: 6px; display: none;">
            <div style="font-size: 12px; margin-bottom: 8px; color: #92400e; font-weight: 600;">‚ö†Ô∏è Save this preimage securely!</div>
            <div style="font-size: 11px; font-family: monospace; word-break: break-all; color: #1a202c; margin-bottom: 4px;">
              <strong>Preimage:</strong> <span id="a_preimage"></span>
            </div>
            <div style="font-size: 11px; font-family: monospace; word-break: break-all; color: #1a202c;">
              <strong>Condition:</strong> <span id="a_conditionDisplay"></span>
            </div>
          </div>
        </div>

        <button id="btnCreate">Create Escrow</button>

        <div class="result" id="resCreate"></div>
      </div>

      <!-- Release -->
      <div class="card">
        <h3>Flow B ‚Äî Release Deposit (EscrowFinish)</h3>
        <p class="muted">Payee claims funds. For conditional escrows, provide the fulfillment (preimage) to release funds.</p>

        <label>Escrow Owner (Payer address) <span style="color: #718096; font-weight: 400;">(who created the escrow)</span></label>
        <input id="b_owner" placeholder="r..." autocomplete="off" />

        <label>Escrow Sequence <span style="color: #718096; font-weight: 400;">(from escrow creation transaction)</span></label>
        <input id="b_seq" type="number" placeholder="123" min="1" autocomplete="off" />

        <div id="b_conditionalSection" style="margin-top: 16px; padding: 12px; background: #fff8e1; border-radius: 8px; border: 1px solid rgba(251, 191, 36, 0.3); display: none;">
          <label>Fulfillment (Preimage) <span style="color: #718096; font-weight: 400;">(required for conditional escrows)</span></label>
          <input id="b_fulfillment" placeholder="Paste the preimage/fulfillment here" autocomplete="off" style="font-family: monospace; font-size: 12px;" />
          <p style="margin: 8px 0 0; font-size: 11px; color: #718096;">If this is a conditional escrow, you need the preimage that matches the condition to finish it.</p>
        </div>

        <button id="btnFinish">Claim Deposit</button>

        <div class="result" id="resFinish"></div>
      </div>

      <!-- Cancel -->
      <div class="card">
        <h3>Flow C ‚Äî Cancel & Refund (EscrowCancel)</h3>
        <p class="muted">Payer cancels escrow after CancelAfter time. Only works if CancelAfter was set during creation and the time has passed.</p>

        <label>Escrow Owner (Payer address) <span style="color: #718096; font-weight: 400;">(must match escrow creator)</span></label>
        <input id="c_owner" placeholder="r..." autocomplete="off" />

        <label>Escrow Sequence <span style="color: #718096; font-weight: 400;">(from escrow creation transaction)</span></label>
        <input id="c_seq" type="number" placeholder="123" min="1" autocomplete="off" />

        <button id="btnCancel">Cancel & Refund</button>

        <div class="result" id="resCancel"></div>
      </div>
    </div>

    <script src="dashboard.js"></script>
  </body>
</html>
